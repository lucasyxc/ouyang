import{_ as P,r as d,o as V,j as A,k as K,a as L,c as t,w as u,h as T,g as j,b as z,l as $,B as G,e as H,u as Q,P as W,C as X,n as Y,p as Z,q as ee,x as ae,y as le,z as te,A as oe,M as ne,v,i as re}from"./index-BmxR4WCw.js";import{p as y}from"./product-CiH2I8No.js";import"./request-C7sc0_J1.js";const ue={class:"product-container"},se=["onClick"],ie={__name:"index",setup(de){const q=A(),O=K(),f=d([]),S=d([]),g=d(!1),p=d(!1),b=d("新增产品"),w=d(!1),e=d({}),x=d(null),k=[{title:"产品名称",dataIndex:"name",key:"name",width:200},{title:"产品类型",dataIndex:"product_type",key:"product_type",width:150,customRender:({text:o})=>({class3:"三类医疗器械",class2:"二类医疗器械",class1:"一类医疗器械",non_medical:"非医疗器械商品"})[o]||o},{title:"型号",dataIndex:"model",key:"model",width:120},{title:"规格",dataIndex:"specification",key:"specification",width:120},{title:"注册证编号",dataIndex:"registration_number",key:"registration_number",width:180},{title:"生产企业",dataIndex:"manufacturer_id",key:"manufacturer_id",width:200,customRender:({text:o})=>{const a=f.value.find(s=>s.value==o);return a?a.label:o}},{title:"有效期(月)",dataIndex:"valid_period",key:"valid_period",width:100},{title:"操作",key:"action",width:150,fixed:"right",slots:{customRender:"action"}}],N={name:[{required:!0,message:"请输入产品名称",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],product_type:[{required:!0,message:"请选择产品类型",trigger:"change"}],model:[{required:!0,message:"请输入型号",trigger:"blur"}],manufacturer:[{required:!0,message:"请输入生产企业",trigger:"blur"}]},R=[{label:"三类医疗器械",value:"class3"},{label:"二类医疗器械",value:"class2"},{label:"一类医疗器械",value:"class1"},{label:"非医疗器械商品",value:"non_medical"}],I=async()=>{g.value=!0;try{const o=localStorage.getItem("user");let a=null;if(o)try{a=JSON.parse(o).id}catch(r){console.error("解析 localStorage 中 user 出错:",r)}console.log("发送给后端的请求参数:",{id:a});const s=await y.getList({id:a});if(console.log("后端返回的产品列表数据:",s),s.status==="success"){S.value=s.devices;try{localStorage.setItem("products",JSON.stringify(s.devices)),console.log("产品列表数据已保存到 localStorage")}catch(r){console.error("保存产品列表到 localStorage 时出错:",r)}}else v.error("获取产品列表失败")}catch{v.error("获取产品列表失败")}finally{g.value=!1}},h=()=>{b.value="新增产品",e.value={requires_tracking:!1},p.value=!0},C=o=>{b.value="编辑产品",e.value={...o},p.value=!0},D=async()=>{try{await x.value.validate(),w.value=!0;const o=["name","product_type","model","specification","registration_number","manufacturer","valid_period","requires_tracking","description"],a=localStorage.getItem("user");let s=" ";if(a)try{s=JSON.parse(a).id}catch(r){console.error("解析 localStorage 中 user 出错:",r)}if(e.value.id){let r=new FormData;o.forEach(l=>{l==="manufacturer"?r.append("supplier_id",e.value.manufacturer===void 0||e.value.manufacturer===null?" ":e.value.manufacturer):l==="valid_period"?r.append(l,e.value[l]===void 0||e.value[l]===null||e.value[l]===""?"":e.value[l]):r.append(l,e.value[l]===void 0||e.value[l]===null?" ":e.value[l])}),r.append("id",s),console.log("发送给后端的产品更新数据:");for(let[l,m]of r.entries())console.log(l,m);const c=await y.update(e.value.id,r);console.log("后端返回的产品更新结果:",c),v.success("更新成功")}else{let r=new FormData;o.forEach(l=>{l==="manufacturer"?r.append("supplier_id",e.value.manufacturer===void 0||e.value.manufacturer===null?" ":e.value.manufacturer):l==="valid_period"?r.append(l,e.value[l]===void 0||e.value[l]===null||e.value[l]===""?"":e.value[l]):r.append(l,e.value[l]===void 0||e.value[l]===null?" ":e.value[l])}),r.append("id",s),console.log("发送给后端的产品创建数据:");for(let[l,m]of r.entries())console.log(l,m);const c=await y.create(r);console.log("后端返回的产品创建结果:",c),v.success("创建成功")}p.value=!1,I()}catch(o){console.error("表单提交错误:",o),v.error("操作失败")}finally{w.value=!1}};return V(()=>{I();const o=localStorage.getItem("suppliers");if(o)try{const a=JSON.parse(o);f.value=a.map(s=>({label:s.name,value:s.id}))}catch(a){console.error("解析供应商列表出错:",a)}q.query.modal==="add"&&(h(),O.replace({query:{}}))}),(o,a)=>{const s=$,r=G,c=j,l=T,m=X,_=ee,i=Z,U=ae,B=le,M=te,E=oe,F=Y,J=ne;return re(),L("div",ue,[t(m,{title:"产品管理"},{extra:u(()=>[t(c,null,{default:u(()=>[t(s,{value:o.searchKeyword,"onUpdate:value":a[0]||(a[0]=n=>o.searchKeyword=n),placeholder:"搜索产品",style:{width:"200px"},onSearch:o.onSearch},null,8,["value","onSearch"]),t(r,{type:"primary",onClick:h},{icon:u(()=>[t(Q(W))]),default:u(()=>[a[11]||(a[11]=H(" 新增产品 "))]),_:1})]),_:1})]),default:u(()=>[t(l,{columns:k,"data-source":S.value,loading:g.value,scroll:{x:1500},"row-key":"id"},{action:u(({record:n})=>[t(c,null,{default:u(()=>[z("a",{onClick:ce=>C(n)},"编辑",8,se)]),_:2},1024)]),_:1},8,["data-source","loading"])]),_:1}),t(J,{visible:p.value,"onUpdate:visible":a[10]||(a[10]=n=>p.value=n),title:b.value,"confirm-loading":w.value,onOk:D,width:"700px"},{default:u(()=>[t(F,{ref_key:"formRef",ref:x,model:e.value,rules:N,"label-col":{span:6},"wrapper-col":{span:16}},{default:u(()=>[t(i,{label:"产品名称",name:"name"},{default:u(()=>[t(_,{value:e.value.name,"onUpdate:value":a[1]||(a[1]=n=>e.value.name=n)},null,8,["value"])]),_:1}),t(i,{label:"产品类型",name:"product_type"},{default:u(()=>[t(U,{value:e.value.product_type,"onUpdate:value":a[2]||(a[2]=n=>e.value.product_type=n),options:R},null,8,["value"])]),_:1}),t(i,{label:"型号",name:"model"},{default:u(()=>[t(_,{value:e.value.model,"onUpdate:value":a[3]||(a[3]=n=>e.value.model=n)},null,8,["value"])]),_:1}),t(i,{label:"规格",name:"specification"},{default:u(()=>[t(_,{value:e.value.specification,"onUpdate:value":a[4]||(a[4]=n=>e.value.specification=n)},null,8,["value"])]),_:1}),t(i,{label:"注册证编号",name:"registration_number"},{default:u(()=>[t(_,{value:e.value.registration_number,"onUpdate:value":a[5]||(a[5]=n=>e.value.registration_number=n)},null,8,["value"])]),_:1}),t(i,{label:"生产企业",name:"manufacturer"},{default:u(()=>[t(U,{value:e.value.manufacturer,"onUpdate:value":a[6]||(a[6]=n=>e.value.manufacturer=n),options:f.value,placeholder:"请选择供应商"},null,8,["value","options"])]),_:1}),t(i,{label:"有效期(月)",name:"valid_period"},{default:u(()=>[t(B,{value:e.value.valid_period,"onUpdate:value":a[7]||(a[7]=n=>e.value.valid_period=n),min:0},null,8,["value"])]),_:1}),t(i,{label:"是否追溯",name:"requires_tracking"},{default:u(()=>[t(M,{checked:e.value.requires_tracking,"onUpdate:checked":a[8]||(a[8]=n=>e.value.requires_tracking=n)},null,8,["checked"])]),_:1}),t(i,{label:"描述",name:"description"},{default:u(()=>[t(E,{value:e.value.description,"onUpdate:value":a[9]||(a[9]=n=>e.value.description=n),rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","confirm-loading"])])}}},_e=P(ie,[["__scopeId","data-v-6527ae72"]]);export{_e as default};
