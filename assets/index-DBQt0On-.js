import{_ as Q,r as u,o as W,j as X,k as Z,a as ee,c as a,w as o,C as ae,M as te,l as i,e as le,i as ne,h as oe,b as C,n as ue,R as re,p as se,B as ie,g as de,u as ce,P as _e,q as me,s as ve,G as pe,z as fe,v as ge,A as be}from"./index-CB7tuZ5q.js";import{r as c}from"./request-BsIQN7sp.js";import{p as ye}from"./product-C1xsGwI1.js";import{d as we}from"./dealer-Cl3Hv7VQ.js";const _={getList(r){return c.get("/api/sales/",{params:r})},create(r){return c.post("/api/sales/",r)},update(r,m){return c.put(`/api/sales/${r}/`,m)},delete(r){return c.delete(`/api/sales/${r}/`)}},ke={class:"sale-container"},he=["onClick"],xe={__name:"index",setup(r){const m=X(),Y=Z(),w=u([]),v=u(""),M=n=>{console.log("日期范围变化:",n)},S=()=>{console.log("搜索关键词:",v.value)},k=u([]),p=u(!1),h=u([]),x=u([]),d=u(!1),f=u("新增销售记录"),g=u(!1),l=u({}),q=u(null),$=[{title:"销售日期",dataIndex:"sale_date",key:"sale_date",width:120},{title:"产品名称",dataIndex:["device","name"],key:"device_name",width:200},{title:"批号",dataIndex:"batch_number",key:"batch_number",width:150},{title:"客户单位",dataIndex:["dealer","name"],key:"dealer_name",width:200},{title:"经办人",dataIndex:"customer_name",key:"customer_name",width:120},{title:"数量",dataIndex:"quantity",key:"quantity",width:100},{title:"单价",dataIndex:"unit_price",key:"unit_price",width:120,customRender:({text:n})=>`¥${n}`},{title:"总价",key:"total_price",width:120,customRender:({record:n})=>`¥${(n.quantity*n.unit_price).toFixed(2)}`},{title:"发票号",dataIndex:"invoice_number",key:"invoice_number",width:150},{title:"操作",key:"action",width:150,fixed:"right",slots:{customRender:"action"}}],A={device:[{required:!0,message:"请选择产品",trigger:"change"}],dealer:[{required:!0,message:"请选择客户",trigger:"change"}],sale_date:[{required:!0,message:"请选择销售日期",trigger:"change"}],batch_number:[{required:!0,message:"请输入批号",trigger:"blur"}],customer_name:[{required:!0,message:"请输入经办人姓名",trigger:"blur"}],quantity:[{required:!0,message:"请输入数量",trigger:"blur"}],unit_price:[{required:!0,message:"请输入单价",trigger:"blur"}]},b=async()=>{p.value=!0;try{const n=await _.getList();k.value=n.data}catch{i.error("获取销售记录失败")}finally{p.value=!1}},B=async()=>{try{const n=await ye.getList();h.value=n.data.map(e=>({label:e.name,value:e.id}))}catch{i.error("获取产品列表失败")}},L=async()=>{try{const n=await we.getList();x.value=n.data.map(e=>({label:e.name,value:e.id}))}catch{i.error("获取客户列表失败")}},D=()=>{f.value="新增销售记录",l.value={sale_date:new Date().toISOString().split("T")[0]},d.value=!0},P=n=>{f.value="编辑销售记录",l.value={...n},d.value=!0},V=async()=>{try{await q.value.validate(),g.value=!0,l.value.id?(await _.update(l.value.id,l.value),i.success("更新成功")):(await _.create(l.value),i.success("创建成功")),d.value=!1,b()}catch(n){console.error("表单提交错误:",n),i.error("操作失败")}finally{g.value=!1}},F=async n=>{try{await _.delete(n.id),i.success("删除成功"),b()}catch{i.error("删除失败")}};return W(()=>{b(),B(),L(),m.query.modal==="add"&&(D(),Y.replace({query:{}}))}),(n,e)=>{const N=re,O=se,T=ie,I=oe,E=ue,j=ne,z=ae,G=pe,s=ve,R=fe,y=ge,U=be,K=me,H=te;return le(),ee("div",ke,[a(z,{title:"销售记录"},{extra:o(()=>[a(I,null,{default:o(()=>[a(N,{value:w.value,"onUpdate:value":e[0]||(e[0]=t=>w.value=t),onChange:M,"value-format":"YYYY-MM-DD"},null,8,["value"]),a(O,{value:v.value,"onUpdate:value":e[1]||(e[1]=t=>v.value=t),placeholder:"搜索销售记录",style:{width:"200px"},onSearch:S},null,8,["value"]),a(T,{type:"primary",onClick:D},{icon:o(()=>[a(ce(_e))]),default:o(()=>[e[11]||(e[11]=de(" 新增销售 "))]),_:1})]),_:1})]),default:o(()=>[a(j,{columns:$,"data-source":k.value,loading:p.value,scroll:{x:1800},"row-key":"id"},{action:o(({record:t})=>[a(I,null,{default:o(()=>[C("a",{onClick:J=>P(t)},"编辑",8,he),a(E,{title:"确定删除该销售记录吗？",onConfirm:J=>F(t)},{default:o(()=>e[12]||(e[12]=[C("a",null,"删除",-1)])),_:2},1032,["onConfirm"])]),_:2},1024)]),_:1},8,["data-source","loading"])]),_:1}),a(H,{visible:d.value,"onUpdate:visible":e[10]||(e[10]=t=>d.value=t),title:f.value,"confirm-loading":g.value,onOk:V,width:"700px"},{default:o(()=>[a(K,{ref_key:"formRef",ref:q,model:l.value,rules:A,"label-col":{span:6},"wrapper-col":{span:16}},{default:o(()=>[a(s,{label:"销售日期",name:"sale_date"},{default:o(()=>[a(G,{value:l.value.sale_date,"onUpdate:value":e[2]||(e[2]=t=>l.value.sale_date=t),style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["value"])]),_:1}),a(s,{label:"产品",name:"device"},{default:o(()=>[a(R,{value:l.value.device,"onUpdate:value":e[3]||(e[3]=t=>l.value.device=t),options:h.value,placeholder:"请选择产品"},null,8,["value","options"])]),_:1}),a(s,{label:"批号",name:"batch_number"},{default:o(()=>[a(y,{value:l.value.batch_number,"onUpdate:value":e[4]||(e[4]=t=>l.value.batch_number=t)},null,8,["value"])]),_:1}),a(s,{label:"客户单位",name:"dealer"},{default:o(()=>[a(R,{value:l.value.dealer,"onUpdate:value":e[5]||(e[5]=t=>l.value.dealer=t),options:x.value,placeholder:"请选择客户"},null,8,["value","options"])]),_:1}),a(s,{label:"经办人",name:"customer_name"},{default:o(()=>[a(y,{value:l.value.customer_name,"onUpdate:value":e[6]||(e[6]=t=>l.value.customer_name=t)},null,8,["value"])]),_:1}),a(s,{label:"数量",name:"quantity"},{default:o(()=>[a(U,{value:l.value.quantity,"onUpdate:value":e[7]||(e[7]=t=>l.value.quantity=t),min:1,style:{width:"100%"}},null,8,["value"])]),_:1}),a(s,{label:"单价",name:"unit_price"},{default:o(()=>[a(U,{value:l.value.unit_price,"onUpdate:value":e[8]||(e[8]=t=>l.value.unit_price=t),min:0,precision:2,step:.01,style:{width:"100%"}},null,8,["value"])]),_:1}),a(s,{label:"发票号",name:"invoice_number"},{default:o(()=>[a(y,{value:l.value.invoice_number,"onUpdate:value":e[9]||(e[9]=t=>l.value.invoice_number=t)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","confirm-loading"])])}}},Ue=Q(xe,[["__scopeId","data-v-c7e09924"]]);export{Ue as default};
