import{_ as K,r,o as L,j as P,k as j,a as z,c as a,w as n,C as G,M as H,l as s,e as J,i as Q,h as W,b as k,n as X,p as Y,B as Z,g as ee,u as ae,P as te,q as le,s as ne,v as oe,z as ue,A as re,D as se,x as ie}from"./index-11ghoq9T.js";import{p as c}from"./product-BbFDpQC-.js";import"./request-CsfeIQjt.js";const de={class:"product-container"},ce=["onClick"],pe={__name:"index",setup(_e){const w=P(),x=j(),f=r([]),p=r(!1),i=r(!1),_=r("新增产品"),m=r(!1),t=r({}),g=r(null),q=[{title:"产品名称",dataIndex:"name",key:"name",width:200},{title:"产品类型",dataIndex:"product_type",key:"product_type",width:150,customRender:({text:o})=>({class3:"三类医疗器械",class2:"二类医疗器械",class1:"一类医疗器械",non_medical:"非医疗器械商品"})[o]||o},{title:"型号",dataIndex:"model",key:"model",width:120},{title:"规格",dataIndex:"specification",key:"specification",width:120},{title:"注册证编号",dataIndex:"registration_number",key:"registration_number",width:180},{title:"生产企业",dataIndex:"manufacturer",key:"manufacturer",width:200},{title:"有效期(月)",dataIndex:"valid_period",key:"valid_period",width:100},{title:"操作",key:"action",width:150,fixed:"right",slots:{customRender:"action"}}],U={name:[{required:!0,message:"请输入产品名称",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],product_type:[{required:!0,message:"请选择产品类型",trigger:"change"}],model:[{required:!0,message:"请输入型号",trigger:"blur"}],manufacturer:[{required:!0,message:"请输入生产企业",trigger:"blur"}]},h=[{label:"三类医疗器械",value:"class3"},{label:"二类医疗器械",value:"class2"},{label:"一类医疗器械",value:"class1"},{label:"非医疗器械商品",value:"non_medical"}],v=async()=>{p.value=!0;try{const o=await c.getList();f.value=o.data}catch{s.error("获取产品列表失败")}finally{p.value=!1}},y=()=>{_.value="新增产品",t.value={requires_tracking:!1},i.value=!0},I=o=>{_.value="编辑产品",t.value={...o},i.value=!0},C=async()=>{try{await g.value.validate(),m.value=!0,t.value.id?(await c.update(t.value.id,t.value),s.success("更新成功")):(await c.create(t.value),s.success("创建成功")),i.value=!1,v()}catch(o){console.error("表单提交错误:",o),s.error("操作失败")}finally{m.value=!1}},R=async o=>{try{await c.delete(o.id),s.success("删除成功"),v()}catch{s.error("删除失败")}};return L(()=>{v(),w.query.modal==="add"&&(y(),x.replace({query:{}}))}),(o,e)=>{const S=Y,B=Z,b=W,M=X,D=Q,V=G,d=oe,u=ne,A=ue,N=re,O=se,T=ie,$=le,E=H;return J(),z("div",de,[a(V,{title:"产品管理"},{extra:n(()=>[a(b,null,{default:n(()=>[a(S,{value:o.searchKeyword,"onUpdate:value":e[0]||(e[0]=l=>o.searchKeyword=l),placeholder:"搜索产品",style:{width:"200px"},onSearch:o.onSearch},null,8,["value","onSearch"]),a(B,{type:"primary",onClick:y},{icon:n(()=>[a(ae(te))]),default:n(()=>[e[11]||(e[11]=ee(" 新增产品 "))]),_:1})]),_:1})]),default:n(()=>[a(D,{columns:q,"data-source":f.value,loading:p.value,scroll:{x:1500},"row-key":"id"},{action:n(({record:l})=>[a(b,null,{default:n(()=>[k("a",{onClick:F=>I(l)},"编辑",8,ce),a(M,{title:"确定删除该产品吗？",onConfirm:F=>R(l)},{default:n(()=>e[12]||(e[12]=[k("a",null,"删除",-1)])),_:2},1032,["onConfirm"])]),_:2},1024)]),_:1},8,["data-source","loading"])]),_:1}),a(E,{visible:i.value,"onUpdate:visible":e[10]||(e[10]=l=>i.value=l),title:_.value,"confirm-loading":m.value,onOk:C,width:"700px"},{default:n(()=>[a($,{ref_key:"formRef",ref:g,model:t.value,rules:U,"label-col":{span:6},"wrapper-col":{span:16}},{default:n(()=>[a(u,{label:"产品名称",name:"name"},{default:n(()=>[a(d,{value:t.value.name,"onUpdate:value":e[1]||(e[1]=l=>t.value.name=l)},null,8,["value"])]),_:1}),a(u,{label:"产品类型",name:"product_type"},{default:n(()=>[a(A,{value:t.value.product_type,"onUpdate:value":e[2]||(e[2]=l=>t.value.product_type=l),options:h},null,8,["value"])]),_:1}),a(u,{label:"型号",name:"model"},{default:n(()=>[a(d,{value:t.value.model,"onUpdate:value":e[3]||(e[3]=l=>t.value.model=l)},null,8,["value"])]),_:1}),a(u,{label:"规格",name:"specification"},{default:n(()=>[a(d,{value:t.value.specification,"onUpdate:value":e[4]||(e[4]=l=>t.value.specification=l)},null,8,["value"])]),_:1}),a(u,{label:"注册证编号",name:"registration_number"},{default:n(()=>[a(d,{value:t.value.registration_number,"onUpdate:value":e[5]||(e[5]=l=>t.value.registration_number=l)},null,8,["value"])]),_:1}),a(u,{label:"生产企业",name:"manufacturer"},{default:n(()=>[a(d,{value:t.value.manufacturer,"onUpdate:value":e[6]||(e[6]=l=>t.value.manufacturer=l)},null,8,["value"])]),_:1}),a(u,{label:"有效期(月)",name:"valid_period"},{default:n(()=>[a(N,{value:t.value.valid_period,"onUpdate:value":e[7]||(e[7]=l=>t.value.valid_period=l),min:0},null,8,["value"])]),_:1}),a(u,{label:"是否追溯",name:"requires_tracking"},{default:n(()=>[a(O,{checked:t.value.requires_tracking,"onUpdate:checked":e[8]||(e[8]=l=>t.value.requires_tracking=l)},null,8,["checked"])]),_:1}),a(u,{label:"描述",name:"description"},{default:n(()=>[a(T,{value:t.value.description,"onUpdate:value":e[9]||(e[9]=l=>t.value.description=l),rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","confirm-loading"])])}}},ge=K(pe,[["__scopeId","data-v-e242d9cc"]]);export{ge as default};
