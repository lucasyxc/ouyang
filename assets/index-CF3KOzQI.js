import{r as v}from"./request-DAaqQaFE.js";import{_ as j,r as d,o as B,a as $,c as a,w as t,h as V,g as J,b as U,D as R,B as E,e as x,u as T,P as G,C as H,n as K,p as Q,q as W,s as X,A as Z,G as ee,M as le,v as c,i as ae}from"./index-B9ra-Aqz.js";const f={getList(r){return v.get("/suppliers/list",{params:r})},create(r){return v.post("/suppliers/create/",r)},update(r,m){return v.post(`/suppliers/edit/${r}/`,m)},delete(r){return v.delete(`/suppliers/delete/${r}/`)}},ne={class:"supplier-container"},se=["onClick"],te={__name:"index",setup(r){const m=d([]),b=d(!1),p=d(!1),g=d("新增供应商"),y=d(!1),e=d({}),k=d(null),D=[{title:"供应商名称",dataIndex:"name",key:"name",width:200},{title:"营业执照编号",dataIndex:"license_number",key:"license_number",width:150},{title:"联系人",dataIndex:"contact_person",key:"contact_person",width:120},{title:"联系电话",dataIndex:"contact_phone",key:"contact_phone",width:150},{title:"地址",dataIndex:"address",key:"address",width:250},{title:"授权经营范围",dataIndex:"authorized_scope",key:"authorized_scope",width:200},{title:"营业执照有效期",dataIndex:"valid_until",key:"valid_until",width:120},{title:"医疗器械许可证编号",dataIndex:"medical_license_number",key:"medical_license_number",width:150},{title:"医疗器械许可证有效期",dataIndex:"medical_license_valid_until",key:"medical_license_valid_until",width:120},{title:"操作",key:"action",fixed:"right",width:150,slots:{customRender:"action"}}],S={name:[{required:!0,message:"请输入供应商名称",trigger:"blur"}],license_number:[{required:!0,message:"请输入营业执照编号",trigger:"blur"}],contact_person:[{required:!0,message:"请输入联系人姓名",trigger:"blur"}],contact_phone:[{required:!0,message:"请输入联系电话",trigger:"blur"}],address:[{required:!0,message:"请输入地址",trigger:"blur"}],authorized_scope:[],valid_until:[{required:!0,message:"请选择营业执照有效期",trigger:"change"}],business_license:[{required:!0,trigger:"change",validator:(i,l)=>l&&l.length>0?Promise.resolve():Promise.reject("请上传营业执照文件")}]},w=async()=>{b.value=!0;try{const i=localStorage.getItem("user");let l="";if(i)try{l=JSON.parse(i).id}catch(u){console.error("解析 localStorage 用户信息出错:",u)}const s=await f.getList({user_id:l});s.status==="success"?(m.value=s.suppliers,console.log("供应商列表数据:",s.suppliers),localStorage.setItem("suppliers",JSON.stringify(s.suppliers))):c.error(s.message||"获取供应商列表失败")}catch{c.error("获取供应商列表失败")}finally{b.value=!1}},q=()=>{g.value="新增供应商",e.value={},p.value=!0},L=i=>{g.value="编辑供应商",e.value={...i},e.value.business_license&&!Array.isArray(e.value.business_license)?e.value.business_license=[{uid:"-1",name:"business_license",url:e.value.business_license}]:e.value.business_license||(e.value.business_license=[]),e.value.medical_license_file&&!Array.isArray(e.value.medical_license_file)?e.value.medical_license_file=[{uid:"-1",name:"medical_license_file",url:e.value.medical_license_file}]:e.value.medical_license_file||(e.value.medical_license_file=[]),p.value=!0},O=async()=>{try{await k.value.validate(),y.value=!0;const i=localStorage.getItem("user");let l="";if(i)try{l=JSON.parse(i).id}catch(u){console.error("解析 localStorage 用户信息出错:",u)}let s=new FormData;s.append("name",e.value.name||""),s.append("license_number",e.value.license_number||""),s.append("contact_person",e.value.contact_person||""),s.append("contact_phone",e.value.contact_phone||""),s.append("address",e.value.address||""),s.append("authorized_scope",e.value.authorized_scope||""),s.append("valid_until",e.value.valid_until||""),s.append("medical_license_number",e.value.medical_license_number||""),s.append("medical_license_valid_until",e.value.medical_license_valid_until||""),s.append("user_id",l),e.value.business_license&&e.value.business_license.length>0&&e.value.business_license[0].originFileObj&&s.append("business_license",e.value.business_license[0].originFileObj),e.value.medical_license_file&&e.value.medical_license_file.length>0&&e.value.medical_license_file[0].originFileObj&&s.append("medical_license_file",e.value.medical_license_file[0].originFileObj),console.log("发送的数据:");for(const u of s.entries())console.log(`${u[0]}:`,u[1]);if(e.value.id){const u=await f.update(e.value.id,s);c.success("更新成功"),console.log("后端返回的数据:",u)}else{const u=await f.create(s);c.success("创建成功"),console.log("后端返回的数据:",u)}p.value=!1,w()}catch(i){console.error("表单提交错误:",i),c.error("操作失败")}finally{y.value=!1}},z=async i=>{try{await f.delete(i.id),c.success("删除成功"),w()}catch{c.error("删除失败")}};return B(()=>{w()}),(i,l)=>{const s=E,u=R,C=J,Y=V,A=H,_=W,o=Q,h=X,F=Z,I=ee,M=K,N=le;return ae(),$("div",ne,[a(A,{title:"供应商管理"},{extra:t(()=>[a(s,{type:"primary",onClick:q},{icon:t(()=>[a(T(G))]),default:t(()=>[l[12]||(l[12]=x(" 新增供应商 "))]),_:1})]),default:t(()=>[a(Y,{columns:D,"data-source":m.value,loading:b.value,"row-key":"id",scroll:{x:1500}},{action:t(({record:n})=>[a(C,null,{default:t(()=>[U("a",{onClick:P=>L(n)},"编辑",8,se),a(u,{title:"确定删除该供应商吗？",onConfirm:P=>z(n)},{default:t(()=>l[13]||(l[13]=[U("a",null,"删除",-1)])),_:2},1032,["onConfirm"])]),_:2},1024)]),_:1},8,["data-source","loading"])]),_:1}),a(N,{visible:p.value,"onUpdate:visible":l[11]||(l[11]=n=>p.value=n),title:g.value,"confirm-loading":y.value,onOk:O,width:"700px"},{default:t(()=>[a(M,{ref_key:"formRef",ref:k,model:e.value,rules:S,"label-col":{span:6},"wrapper-col":{span:16}},{default:t(()=>[a(o,{label:"供应商名称",name:"name"},{default:t(()=>[a(_,{value:e.value.name,"onUpdate:value":l[0]||(l[0]=n=>e.value.name=n)},null,8,["value"])]),_:1}),a(o,{label:"营业执照编号",name:"license_number"},{default:t(()=>[a(_,{value:e.value.license_number,"onUpdate:value":l[1]||(l[1]=n=>e.value.license_number=n)},null,8,["value"])]),_:1}),a(o,{label:"营业执照文件",name:"business_license"},{default:t(()=>[a(h,{fileList:e.value.business_license,"onUpdate:fileList":l[2]||(l[2]=n=>e.value.business_license=n),"before-upload":()=>!1},{default:t(()=>[a(s,null,{default:t(()=>l[14]||(l[14]=[x("上传文件")])),_:1})]),_:1},8,["fileList"])]),_:1}),a(o,{label:"联系人",name:"contact_person"},{default:t(()=>[a(_,{value:e.value.contact_person,"onUpdate:value":l[3]||(l[3]=n=>e.value.contact_person=n)},null,8,["value"])]),_:1}),a(o,{label:"联系电话",name:"contact_phone"},{default:t(()=>[a(_,{value:e.value.contact_phone,"onUpdate:value":l[4]||(l[4]=n=>e.value.contact_phone=n)},null,8,["value"])]),_:1}),a(o,{label:"地址",name:"address"},{default:t(()=>[a(_,{value:e.value.address,"onUpdate:value":l[5]||(l[5]=n=>e.value.address=n)},null,8,["value"])]),_:1}),a(o,{label:"授权经营范围",name:"authorized_scope"},{default:t(()=>[a(F,{value:e.value.authorized_scope,"onUpdate:value":l[6]||(l[6]=n=>e.value.authorized_scope=n)},null,8,["value"])]),_:1}),a(o,{label:"营业执照有效期",name:"valid_until"},{default:t(()=>[a(I,{value:e.value.valid_until,"onUpdate:value":l[7]||(l[7]=n=>e.value.valid_until=n),style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["value"])]),_:1}),a(o,{label:"医疗器械许可证编号",name:"medical_license_number"},{default:t(()=>[a(_,{value:e.value.medical_license_number,"onUpdate:value":l[8]||(l[8]=n=>e.value.medical_license_number=n)},null,8,["value"])]),_:1}),a(o,{label:"医疗器械许可证文件",name:"medical_license_file"},{default:t(()=>[a(h,{fileList:e.value.medical_license_file,"onUpdate:fileList":l[9]||(l[9]=n=>e.value.medical_license_file=n),"before-upload":()=>!1},{default:t(()=>[a(s,null,{default:t(()=>l[15]||(l[15]=[x("上传文件")])),_:1})]),_:1},8,["fileList"])]),_:1}),a(o,{label:"医疗器械许可证有效期",name:"medical_license_valid_until"},{default:t(()=>[a(I,{value:e.value.medical_license_valid_until,"onUpdate:value":l[10]||(l[10]=n=>e.value.medical_license_valid_until=n),style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","confirm-loading"])])}}},oe=j(te,[["__scopeId","data-v-7ee72c46"]]);export{oe as default};
